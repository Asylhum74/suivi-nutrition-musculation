<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Suivi nutritif & musculaire</title>
<style>
/* --- Styles identiques à ton précédent setup --- */
* { box-sizing: border-box; margin: 0; padding: 0; font-family: Arial, sans-serif; }
body { background: #f4f6f8; color: #333; }
header { background: #1e293b; color: white; padding: 20px; text-align: center; }
.tabs { display: flex; justify-content: center; background: #0f172a; }
.tabs button { flex: 1; padding: 15px; border: none; background: transparent; color: #cbd5f5; cursor: pointer; font-size: 16px; }
.tabs button:hover { background: #1e293b; }
main { max-width: 1200px; margin: 30px auto; padding: 20px; }
.tab { display: none; }
.tab.active { display: block; }
h2 { margin-bottom: 20px; color: #1e293b; }
.form { display: grid; gap: 15px; max-width: 400px; }
label { display: flex; justify-content: space-between; align-items: center; }
input { width: 120px; padding: 6px; }
button#saveProfile { padding: 10px; background: #2563eb; color: white; border: none; border-radius: 6px; cursor: pointer; }
button#saveProfile:hover { background: #1d4ed8; }
#profileSummary { margin-top: 25px; background: #f1f5f9; padding: 15px; border-radius: 8px; }

/* Sous-onglets musculation */
.training-subtabs { display: flex; gap: 10px; margin-bottom: 15px; }
.training-subtabs button { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; background: #cbd5f5; color: #0f172a; }
.training-subtabs button.active { background: #2563eb; color: white; }
.subtab { display: none; }
.subtab.active { display: block; }

/* Exercices */
.training-container { display: flex; gap: 20px; }
.exercises-panel, .exercise-detail-panel { background: white; border-radius: 10px; padding: 15px; flex: 1; max-height: 600px; overflow-y: auto; box-shadow: 0 8px 16px rgba(0,0,0,0.08); }
.exercises-panel h3, .exercise-detail-panel h3 { margin-bottom: 15px; color: #1e293b; }
.list { list-style: none; padding-left: 0; display: flex; flex-direction: column; gap: 12px; }
.card { padding: 12px; border-radius: 8px; background: #f8fafc; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.06); transition: background 0.2s; }
.card:hover { background: #e0f2fe; }

/* Programme */
.program-panel { background: white; border-radius: 10px; padding: 15px; max-height: 600px; overflow-y: auto; box-shadow: 0 8px 16px rgba(0,0,0,0.08); }
.program-panel h3 { margin-bottom: 15px; color: #1e293b; }
.program-item { display: flex; flex-direction: column; gap: 6px; background: #f1f5f9; padding: 10px; border-radius: 8px; }
.program-item span { font-weight: bold; }
.program-item input { width: 60px; padding: 4px; border-radius: 4px; border: 1px solid #cbd5f5; }
.program-item button.removeExo { padding: 4px 8px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; }
.program-item button.removeExo:hover { background: #b91c1c; }
button.addProgram, #saveProgram { margin-top: 10px; padding: 8px 12px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; }
button.addProgram:hover, #saveProgram:hover { background: #059669; }
</style>
</head>
<body>
<header>
<h1>Suivi nutritif & musculaire</h1>
</header>
<nav class="tabs">
<button data-tab="dashboard">Profil</button>
<button data-tab="training">Musculation</button>
<button data-tab="nutrition">Nutrition</button>
</nav>
<main>
<section id="dashboard" class="tab active">
<h2>Profil utilisateur</h2>
<div class="form">
<label>Âge <input type="number" id="age"></label>
<label>Taille (cm) <input type="number" id="taille"></label>
<label>Poids (kg) <input type="number" id="poids"></label>
<button id="saveProfile">Enregistrer</button>
</div>
<div id="profileSummary"></div>
</section>

<section id="training" class="tab">
<div class="training-subtabs">
<button data-subtab="exercises" class="active">Exercices</button>
<button data-subtab="program">Programme</button>
</div>

<div id="exercisesTab" class="subtab active">
<div class="training-container">
<div class="exercises-panel">
<h3>Liste des exercices</h3>
<div class="filter">
<select id="filterMuscle"><option value="all">Tous les muscles</option></select>
<select id="filterGoal"><option value="all">Tous les objectifs</option></select>
</div>
<ul id="exerciseList" class="list"></ul>
</div>
<div class="exercise-detail-panel" id="exerciseDetailPanel">
<h3>Détails de l'exercice</h3>
<p>Cliquez sur un exercice pour voir ses détails ici.</p>
<div id="exercise3D" style="width:100%; height:300px;"></div>
</div>
</div>
</div>

<div id="programTab" class="subtab">
<div class="program-panel">
<h3>Programme en cours</h3>
<ul id="programList"></ul>
<button id="saveProgram">Sauvegarder programme</button>
</div>
</div>
</section>

<section id="nutrition" class="tab">
<h2>Aliments</h2>
<ul id="foodList" class="list"></ul>
</section>

<!-- ES Modules Three.js -->
<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js';

// --- Onglets principaux ---
document.querySelectorAll('.tabs button').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

// --- Sous-onglets Musculation ---
const subtabButtons = document.querySelectorAll('.training-subtabs button');
subtabButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    subtabButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    document.querySelectorAll('.subtab').forEach(st => st.classList.remove('active'));
    document.getElementById(btn.dataset.subtab+'Tab').classList.add('active');
  });
});

// --- Profil ---
const ageInput = document.getElementById('age');
const tailleInput = document.getElementById('taille');
const poidsInput = document.getElementById('poids');
const summary = document.getElementById('profileSummary');
function loadProfile() {
  const data = JSON.parse(localStorage.getItem('profile'));
  if (!data) return;
  ageInput.value = data.age;
  tailleInput.value = data.taille;
  poidsInput.value = data.poids;
  renderProfile(data);
}
function renderProfile(data) {
  summary.innerHTML=`<p>Âge : <strong>${data.age}</strong> ans</p><p>Taille : <strong>${data.taille}</strong> cm</p><p>Poids : <strong>${data.poids}</strong> kg</p>`;
}
document.getElementById('saveProfile').addEventListener('click',()=>{
  const profile={age:ageInput.value,taille:tailleInput.value,poids:poidsInput.value};
  localStorage.setItem('profile',JSON.stringify(profile));
  renderProfile(profile);
});
loadProfile();

// --- Exercices ---
const exercises=[
  {name:'Développé couché',muscle:'Pectoraux',goal:'Force / Hypertrophie',desc:'Allongez-vous sur le banc, prenez la barre, abaissez-la lentement sur votre poitrine et poussez.'},
  {name:'Squat',muscle:'Jambes',goal:'Force globale',desc:'Tenez la barre sur vos épaules, fléchissez les genoux jusqu’à 90°, puis remontez.'},
  {name:'Soulevé de terre',muscle:'Dos / Jambes',goal:'Force',desc:'Pieds à largeur d’épaules, saisissez la barre, dos droit, remontez en extension complète.'},
  {name:'Tractions',muscle:'Dos',goal:'Hypertrophie',desc:'Suspendez-vous à la barre, tirez le menton au-dessus, redescendez lentement.'},
  {name:'Développé militaire',muscle:'Épaules',goal:'Force',desc:'Debout, barre devant épaules, poussez vers le haut jusqu’à extension complète.'},
  {name:'Curl biceps',muscle:'Biceps',goal:'Isolation',desc:'Tenez les haltères, fléchissez les coudes et contractez les biceps.'}
];

const exerciseList=document.getElementById('exerciseList');
const filterMuscle=document.getElementById('filterMuscle');
const filterGoal=document.getElementById('filterGoal');
const exerciseDetailPanel=document.getElementById('exerciseDetailPanel');
const programList=document.getElementById('programList');
const saveProgram=document.getElementById('saveProgram');

const muscles=[...new Set(exercises.map(e=>e.muscle))];
muscles.forEach(m=>filterMuscle.innerHTML+=`<option value='${m}'>${m}</option>`);
const goals=[...new Set(exercises.map(e=>e.goal))];
goals.forEach(g=>filterGoal.innerHTML+=`<option value='${g}'>${g}</option>`);

let selectedProgram=[];
function loadProgram() {
  const saved=JSON.parse(localStorage.getItem('myProgram'));
  if(!saved) return;
  selectedProgram=saved;
  programList.innerHTML='';
  selectedProgram.forEach(item=>{
    const li=document.createElement('li');
    li.classList.add('program-item');
    li.innerHTML=`<span>${item.name}</span> Séries: <input type='number' value='${item.sets}'> Reps: <input type='number' value='${item.reps}'><button class='removeExo'>Supprimer</button>`;
    li.querySelector('.removeExo').addEventListener('click',()=>{
      selectedProgram=selectedProgram.filter(e=>e!==item);
      li.remove();
    });
    programList.appendChild(li);
  });
}
loadProgram();

function renderExercises(){
  exerciseList.innerHTML='';
  const selectedMuscle=filterMuscle.value;
  const selectedGoal=filterGoal.value;
  exercises.filter(exo=>(selectedMuscle==='all'||exo.muscle===selectedMuscle)&&(selectedGoal==='all'||exo.goal===selectedGoal)).forEach(exo=>{
    const li=document.createElement('li');
    li.classList.add('card');
    li.innerHTML=`<strong>${exo.name}</strong><br><small>${exo.muscle} — ${exo.goal}</small>`;
    li.addEventListener('click',()=>{ showExerciseDetail(exo); });
    exerciseList.appendChild(li);
  });
}

function showExerciseDetail(exo){
  exerciseDetailPanel.innerHTML = `
    <h3>${exo.name}</h3>
    <div id="exercise3D" style="width:100%; height:300px;"></div>
    <p><strong>Muscle :</strong> ${exo.muscle}</p>
    <p><strong>Objectif :</strong> ${exo.goal}</p>
    <p>${exo.desc}</p>
    <button class='addProgram'>Ajouter au programme</button>
  `;
  exerciseDetailPanel.querySelector('.addProgram').addEventListener('click', ()=> addToProgram(exo.name));
  init3DModel();
}

function addToProgram(name){
  if(!selectedProgram.find(e=>e.name===name)){
    selectedProgram.push({name, sets:3, reps:10});
    const li=document.createElement('li');
    li.classList.add('program-item');
    li.innerHTML=`<span>${name}</span> Séries: <input type='number' value='3'> Reps: <input type='number' value='10'><button class='removeExo'>Supprimer</button>`;
    li.querySelector('.removeExo').addEventListener('click',()=>{
      selectedProgram=selectedProgram.filter(e=>e.name!==name);
      li.remove();
    });
    programList.appendChild(li);
  }
}

saveProgram.addEventListener('click',()=>{
  document.querySelectorAll('#programList li').forEach((li,i)=>{
    selectedProgram[i].sets=parseInt(li.querySelectorAll('input')[0].value);
    selectedProgram[i].reps=parseInt(li.querySelectorAll('input')[1].value);
  });
  localStorage.setItem('myProgram',JSON.stringify(selectedProgram));
  alert('Programme sauvegardé !');
});

filterMuscle.addEventListener('change',renderExercises);
filterGoal.addEventListener('change',renderExercises);
renderExercises();

// --- Three.js 3D Model ---
function init3DModel(){
  const container = document.getElementById('exercise3D');
  container.innerHTML = '';

  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0xf4f6f8);

  const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
  camera.position.set(3,3,5);

  const renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(container.clientWidth, container.clientHeight);
  container.appendChild(renderer.domElement);

  const geometry = new THREE.BoxGeometry(1,1,1);
  const material = new THREE.MeshStandardMaterial({color:0x2563eb});
  const cube = new THREE.Mesh(geometry, material);
  scene.add(cube);

  const ambientLight = new THREE.AmbientLight(0xffffff,0.7);
  scene.add(ambientLight);
  const dirLight = new THREE.DirectionalLight(0xffffff,0.5);
  dirLight.position.set(5,10,7.5);
  scene.add(dirLight);

  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  function animate(){
    requestAnimationFrame(animate);
    cube.rotation.y += 0.01;
    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  window.addEventListener('resize', ()=>{
    camera.aspect = container.clientWidth / container.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container.clientWidth, container.clientHeight);
  });
}
</script>
</body>
</html>
